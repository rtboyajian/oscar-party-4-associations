<nav>
  <ul>
    <li><a href="/backdoor/directors">Manage Directors</a></li>
    <li><a href="/backdoor/actors">Manage Actors</a></li>
    <li><a href="/backdoor/movies">Manage Movies</a></li>
  </ul>
</nav>

<nav aria-label="breadcrumb">
  <ul>
    <li><a href="/backdoor">Admin</a></li>
    <li><a href="/backdoor/movies">Manage movies</a></li>
    <li>Edit Movie #<%= @the_movie.id %></li>
  </ul>
</nav>

<h1>Edit Movie #<%= @the_movie.id %></h1>

<p>
  <a href="/movies/<%= @the_movie.id %>" target="_blank">View Movie Details</a>
</p>

<hr>

<form action="/backdoor/modify_movie/<%= @the_movie.id %>" method="post">
  <div>
    <label for="title">Title</label>
    <input type="text" id="title" name="query_title" value="<%= @the_movie.title %>" required>
  </div>

  <div>
    <label for="year">Year</label>
    <input type="number" id="year" name="query_year" value="<%= @the_movie.year %>">
  </div>

  <div>
    <label for="duration">Duration (minutes)</label>
    <input type="number" id="duration" name="query_duration" value="<%= @the_movie.duration %>">
  </div>

  <div>
    <label for="description">Description</label>
    <textarea id="description" name="query_description" rows="5"><%= @the_movie.description %></textarea>
  </div>

  <div>
    <label for="image">Image URL</label>
    <input type="text" id="image" name="query_image" value="<%= @the_movie.image %>">
  </div>

  <div>
    <label for="director">Director</label>
    <select id="director" name="query_director_id">
      <option value="">Choose a director...</option>
      <% Director.all.order({ :first_name => :asc, :last_name => :asc }).each do |director| %>
        <option value="<%= director.id %>" <%= "selected" if director.id == @the_movie.director_id %>>
          <%= director.first_name %> <%= director.last_name %>
        </option>
        <% end %>
      </select>
    </div>

    <div>
      <label for="released_on">Release Date</label>
      <input type="date" id="released_on" name="query_released_on" value="<%= @the_movie.released_on %>">
    </div>

    <div>
      <label for="oscar_cohort">Oscar Cohort</label>
      <input type="number" id="oscar_cohort" name="query_oscar_cohort" value="<%= @the_movie.oscar_cohort %>" placeholder="e.g., 73, 88, 96">
    </div>

    <fieldset>
      <legend>Result</legend>
      <input type="radio" id="result_nominated" name="query_result" value="nominated" <%= "checked" if @the_movie.result == "nominated" %>>
      <label for="result_nominated">Nominated</label>
      <input type="radio" id="result_won" name="query_result" value="won" <%= "checked" if @the_movie.result == "won" %>>
      <label for="result_won">Won</label>
      <input type="radio" id="result_did_not_win" name="query_result" value="did not win" <%= "checked" if @the_movie.result == "did not win" %>>
      <label for="result_did_not_win">Did not win</label>
    </fieldset>

    <button type="submit">Update Movie</button>
</form>

<hr>

<h3>Add Credit</h3>
<form action="/backdoor/movies/<%= @the_movie.id %>/insert_credit" method="post">
  <div>
    <label for="credit_role">Role</label>
    <input type="text" id="credit_role" name="query_role" required
          placeholder="e.g., Batman, The Joker, Hermione Granger">
  </div>

  <div>
    <label for="credit_actor">Actor</label>
    <select id="credit_actor" name="query_actor_id" required>
      <option value="">Choose an actor...</option>
      <% Actor.all.order({ :first_name => :asc, :last_name => :asc }).each do |actor| %>
        <option value="<%= actor.id %>">
          <%= actor.first_name %> <%= actor.last_name %>
        </option>
      <% end %>
    </select>
    <p>
      <a href="/backdoor" target="_blank">â†’ Add a new actor if not in the list</a>
    </p>
  </div>

  <button type="submit">Add Credit</button>
</form>

<h3>Current Cast</h3>
<% credits = Credit.where({ :movie_id => @the_movie.id }) %>
<% if credits.any? %>
  <div class="overflow-auto">
    <table style="width: 100%; margin-top: 1rem;">
      <thead>
        <tr>
          <th>Actor</th>
          <th>Role</th>
        </tr>
      </thead>
      <tbody>
        <% credits.each do |credit| %>
          <% a_id = credit.actor_id %>
      
          <% matching_actors = Actor.where({ :id => a_id }) %>
          
          <% actor = matching_actors.at(0) %>
          <tr>
            <td>
              <%= actor.first_name %> <%= actor.last_name %>
            </td>
            <td>
              <%= credit.role %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <p>No cast added yet.</p>
<% end %>
